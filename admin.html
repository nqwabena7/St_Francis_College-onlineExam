<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Exam Results</title>
<style>
body {font-family:Segoe UI,Arial,sans-serif;background:#f8fafc;margin:0;padding:20px;}
.container {max-width:1000px;margin:20px auto;background:#fff;padding:30px;border-radius:12px;box-shadow:0 15px 30px rgba(0,0,0,0.1);}
h1{text-align:center;color:#002147;}
table {width:100%;border-collapse:collapse;margin-top:20px;}
th, td {border:1px solid #ccc;padding:10px;text-align:center;}
th {background:#002147;color:#fff;}
button {padding:10px 20px;margin:10px 5px;border:none;border-radius:8px;cursor:pointer;background:#28a745;color:#fff;}
button.clear{background:#dc3545;}
button:hover{opacity:0.9;}
input[type=file]{margin-top:15px;}
</style>
</head>
<body>

<div class="container">
<h1>Admin Dashboard - Exam Results</h1>

<input type="file" id="csvFiles" accept=".csv" multiple>
<button onclick="mergeCSV()">Load CSV Files</button>
<button onclick="exportAll()">Export Merged CSV</button>
<button class="clear" onclick="clearTable()">Clear Table</button>

<table id="resultsTable">
<thead>
<tr>
<th>#</th>
<th>Name</th>
<th>College</th>
<th>Phone</th>
<th>Score</th>
<th>Total</th>
<th>Percentage</th>
<th>Grade</th>
<th>Date</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
// Store all results
let allResults=[];

function grade(p){
  if(p>=80) return "A";
  if(p>=70) return "B";
  if(p>=60) return "C";
  if(p>=50) return "D";
  return "F";
}

function mergeCSV(){
  const files = document.getElementById("csvFiles").files;
  if(files.length===0){alert("Select CSV files to load."); return;}
  
  let loaded=0;
  allResults=[];

  for(let f of files){
    const reader=new FileReader();
    reader.onload=function(e){
      const lines=e.target.result.split(/\r?\n/).filter(l=>l.trim());
      // Skip header
      for(let i=1;i<lines.length;i++){
        const cols=lines[i].split(",");
        if(cols.length>=7){
          allResults.push({
            name:cols[0],
            college:cols[1],
            phone:cols[2],
            score:parseInt(cols[3]),
            total:parseInt(cols[4]),
            percentage:parseFloat(cols[5]),
            date:cols[6]
          });
        }
      }
      loaded++;
      if(loaded===files.length) renderTable();
    };
    reader.readAsText(f);
  }
}

function renderTable(){
  const tbody=document.querySelector("#resultsTable tbody");
  tbody.innerHTML="";
  allResults.forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${r.name}</td>
      <td>${r.college}</td>
      <td>${r.phone}</td>
      <td>${r.score}</td>
      <td>${r.total}</td>
      <td>${r.percentage}</td>
      <td>${grade(r.percentage)}</td>
      <td>${r.date}</td>
    `;
    tbody.appendChild(tr);
  });
}

function exportAll(){
  if(allResults.length===0){alert("No data to export."); return;}
  let csv="Name,College,Phone,Score,Total,Percentage,Grade,Date\r\n";
  allResults.forEach(r=>{
    csv+=[r.name,r.college,r.phone,r.score,r.total,r.percentage,grade(r.percentage),r.date].join(",")+"\r\n";
  });
  const link=document.createElement("a");
  link.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(csv));
  link.setAttribute("download",`all_exam_results_${new Date().toLocaleDateString()}.csv`);
  document.body.appendChild(link);link.click();document.body.removeChild(link);
}

function clearTable(){
  if(confirm("Clear all loaded results?")){
    allResults=[];
    document.querySelector("#resultsTable tbody").innerHTML="";
  }
}
</script>
</body>
</html>
